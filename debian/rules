#!/usr/bin/make -f

cfgflags = --prefix=/usr
custom_targets = netbiff/netbiff-text netbiff/netbiff-gtk

build: $(custom_targets)

netbiff/netbiff-text:
	./configure $(cfgflags) --disable-gtk
	(cd netbiff && $(MAKE) clean && $(MAKE))
	cp netbiff/netbiff netbiff/netbiff-text

netbiff/netbiff-gtk:
	./configure $(cfgflags) --enable-gtk
	(cd netbiff && $(MAKE) clean && $(MAKE))
	cp netbiff/netbiff netbiff/netbiff-gtk

clean:
	-make distclean
	rm -f $(custom_targets)
	dh_clean

binary: binary-arch binary-indep

binary-indep:

binary-arch: build
	dh_testdir
	dh_clean
	dh_installdirs

# First do text
	cp netbiff/netbiff-text netbiff/netbiff
	(cd netbiff && make prefix=`pwd`/../debian/tmp install)
	dh_installdeb -pnetbiff-client-text -Pdebian/tmp
	dh_shlibdeps -pnetbiff-client-text -Pdebian/tmp
	dh_gencontrol -pnetbiff-client-text -Pdebian/tmp
	dh_builddeb -pnetbiff-client-text -Pdebian/tmp

# And now gtk
	cp netbiff/netbiff-gtk netbiff/netbiff
	(cd netbiff && make prefix=`pwd`/../debian/tmp install)
	dh_installdeb -pnetbiff-client-gtk -Pdebian/tmp
	dh_shlibdeps -pnetbiff-client-gtk -Pdebian/tmp
	dh_gencontrol -pnetbiff-client-gtk -Pdebian/tmp
	dh_builddeb -pnetbiff-client-gtk -Pdebian/tmp

# And now the backends...first imap
	cp backend/netbiffd-imap debian/tmp/usr/bin
	dh_installdeb -pnetbiff-backend-imap -Pdebian/tmp
	dh_shlibdeps -pnetbiff-backend-imap -Pdebian/tmp
	dh_gencontrol -pnetbiff-backend-imap -Pdebian/tmp
	dh_builddeb -pnetbiff-backend-imap -Pdebian/tmp
  
# And then file
	cp backend/netbiffd debian/tmp/usr/bin
	dh_installdeb -pnetbiff-backend-file -Pdebian/tmp
	dh_shlibdeps -pnetbiff-backend-file -Pdebian/tmp
	dh_gencontrol -pnetbiff-backend-file -Pdebian/tmp
	dh_builddeb -pnetbiff-backend-file -Pdebian/tmp

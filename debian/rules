#!/usr/bin/make -f

DH_COMPAT=2

cfgflags = --prefix=/usr
custom_targets = netbiff/netbiff-text netbiff/netbiff-gtk

build: $(custom_targets) backends

netbiff/netbiff-text:
	./configure $(cfgflags) --disable-gtk
	(cd netbiff && $(MAKE) clean && $(MAKE))
	cp netbiff/netbiff netbiff/netbiff-text

netbiff/netbiff-gtk:
	./configure $(cfgflags) --enable-gtk
	(cd netbiff && $(MAKE) clean && $(MAKE))
	cp netbiff/netbiff netbiff/netbiff-gtk

backends:
	./configure $(cfgflags)
	(cd backend && $(MAKE))

clean:
	-make distclean
	rm -f $(custom_targets)
	dh_clean -k

binary: binary-arch binary-indep

binary-indep:

binary-arch: build
	dh_testdir

	dh_installdirs -pnetbiff-text
	dh_installdirs -pnetbiff-gtk
	dh_installdirs -pnetbiffd-imap
	dh_installdirs -pnetbiffd-file

# First do text
	cp netbiff/netbiff-text netbiff/netbiff
	(cd netbiff && make prefix=`pwd`/../debian/netbiff-text install)
# And now gtk
	cp netbiff/netbiff-gtk netbiff/netbiff
	(cd netbiff && make prefix=`pwd`/../debian/netbiff-gtk install)
# And now the backends...first imap
	dh_installdirs -pnetbiffd-imap
	cp backend/netbiffd-imap debian/netbiffd-imap/usr/bin/netbiffd-imap
# And then file
	dh_installdirs -pnetbiffd-file
	cp backend/netbiffd debian/netbiffd-file/usr/bin

	dh_installdeb -a
	dh_installdocs -a
	dh_installchangelogs -a

	dh_undocumented -pnetbiff-text netbiff.1
	dh_undocumented -pnetbiff-gtk netbiff.1
	dh_undocumented -pnetbiffd-imap netbiffd-imap.1
	dh_undocumented -pnetbiffd-file netbiffd.1

	dh_strip -a
	dh_compress -a

	dh_shlibdeps -a
	dh_gencontrol -a
	dh_builddeb -a
